/*!wipe-yl1.0.0 发布日期:2018-11-19*/
function Wipe(t){this.conID=t.id,this.cas=document.getElementById(this.conID),this.context=this.cas.getContext("2d"),this._w=t.imW,this._h=t.imH,this.cas.width=t.imW,this.cas.height=t.imH,this.coverType=t.coverType,this.color=t.color||"#777",this.imgUrl=t.imgUrl,this.bg=t.bg,this.radius=t.radius,this.deliaX=0,this.deliaY=0,this.isMouseDown=!1,this.callback=t.callback,this.area=t.area,this.drawT(),this.move(),this.drawMask()}Wipe.prototype.drawT=function(t,e,i,o){2===arguments.length?(this.context.save(),this.context.beginPath(),this.context.fillStyle="red",this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fill()):(this.context.save(),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,o),this.context.lineCap="round",this.context.lineWidth=2*this.radius,this.context.stroke()),this.context.restore()},Wipe.prototype.getTransparencyPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),i=0;i<e.data.length;i+=4){0===e.data[i+3]&&t++}return this.percent=t/(this._w*this._h)*100,Math.round(this.percent)},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.drawMask=function(){var t=this;"color"===this.coverType?(this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out"):"image"===this.coverType&&(this.img1=new Image,this.img1.src=this.imgUrl,console.log(this.img1),this.img1.onload=function(){t.context.drawImage(t.img1,0,0,t.img1.width,t.img1.height,0,0,t._w,t._h),t.context.globalCompositeOperation="destination-out"})},Wipe.prototype.move=function(){var s,n,c=this;this.device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.startEvt=this.device?"touchstart":"mousedown",this.moveEvt=this.device?"touchmove":"mousemove",this.endEvt=this.device?"touchend":"mouseup";for(var a=this.cas.offsetLeft,h=this.cas.offsetTop,t=this.cas;t=t.offsetParent;)h+=t.offsetTop,a+=t.offsetLeft;this.cas.addEventListener(c.startEvt,function(t){c.isMouseDown=!0;var e=t||window.event;s=document.body.scrollLeft||document.documentElement.scrollLeft,n=document.body.scrollTop||document.documentElement.scrollTop,c.deliaX=c.device?e.touches[0].clientX-a+s:e.clientX-a+s,c.deliaY=c.device?e.touches[0].clientY-h+n:e.clientY-h+n,c.drawT(c.deliaX,c.deliaY)}),this.cas.addEventListener(c.moveEvt,function(t){if(!0!==c.isMouseDown)return!1;var e=t||window.event;s=document.body.scrollLeft||document.documentElement.scrollLeft,n=document.body.scrollTop||document.documentElement.scrollTop,e.preventDefault();var i=c.device?e.touches[0].clientX-a+s:e.clientX-a+s,o=c.device?e.touches[0].clientY-h+n:e.clientY-h+n;c.drawT(c.deliaX,c.deliaY,i,o),c.deliaX=i,c.deliaY=o}),this.cas.addEventListener(c.endEvt,function(t){c.isMouseDown=!1;var e=c.getTransparencyPercent();c.callback.call(window,e);c.context.getImageData(0,0,c.cas.width,c.cas.height);e>=c.area&&c.clearRect()})};