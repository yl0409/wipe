/*!wipe-yl0.0.1 发布日期:2018-11-13*/
var deliaX,deliaY,canvas=document.getElementById("cas"),context=cas.getContext("2d"),_w=cas.width,_h=cas.height,radius=20;function drawMask(e){e.fillStyle="#666",e.fillRect(0,0,_w,_h),e.globalCompositeOperation="destination-out"}function draw(e,t,n,a,i){3===arguments.length?(e.save(),e.beginPath(),e.fillStyle="red",e.arc(t,n,radius,0,2*Math.PI),e.fill()):(e.save(),e.beginPath(),e.moveTo(t,n),e.lineTo(a,i),e.lineCap="round",e.lineWidth=2*radius,e.stroke()),e.restore()}var isMouseDown=!1,device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());console.log(navigator.userAgent),console.log(device);var startEvt=device?"touchstart":"mousedown",moveEvt=device?"touchmove":"mousemove",endEvt=device?"touchend":"mouseup";function getTransparencyPercent(e){for(var t=0,n=e.getImageData(0,0,_w,_h),a=0;a<n.data.length;a+=4){0===n.data[a+3]&&t++}var i=t/(_w*_h)*100;return Math.round(i)}function clear(e){e.clearRect(0,0,_w,_h)}cas.addEventListener(startEvt,function(e){isMouseDown=!0;var t=e||window.enent;deliaX=device?t.touches[0].clientX:t.clientX,deliaY=device?t.touches[0].clientY:t.clientY,draw(context,deliaX,deliaY)}),cas.addEventListener(moveEvt,function(e){if(!0!==isMouseDown)return!1;var t=e||window.event;t.preventDefault();var n=device?t.touches[0].clientX:t.clientX,a=device?t.touches[0].clientY:t.clientY;draw(context,deliaX,deliaY,n,a),deliaX=n,deliaY=a}),cas.addEventListener(endEvt,function(e){isMouseDown=!1;context.getImageData(0,0,cas.width,cas.height);60<=getTransparencyPercent(context)&&(clear(context),alert("哈哈哈哈"))}),window.onload=function(){drawMask(context),isMouseDown=!1};